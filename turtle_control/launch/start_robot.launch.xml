<launch>
    <arg name="cmd_src" default="circle"
        description="Choices for control input: ['circle', 'teleop', 'none']; defaults to circle." />
    <arg name="robot" default="nusim" 
        description="Choices for the robot: ['nusim', 'localhost', 'none']; defaults to nusim (simulator)." />
    <arg name="use_rviz" default="true"
        description="Choices to use rviz: ['true', 'false']; (declared in start_robot, used in load_one launch)" />
    
    <node pkg="turtle_control" exec="turtle_control"
        args="--ros-args --params-file $(find-pkg-share nuturtle_description)/config/diff_params.yaml"/>
    <node pkg="turtle_control" exec="odometry"
        args="--ros-args -p body_id:='blue/base_footprint' -p odom_id:='odom' -p wheel_left:='wheel_left' -p wheel_right:='wheel_right'" />
    
    <node pkg="turtle_control" exec="circle" args="--ros-args -p frequency:='100.0'"
        if="$(eval '\'$(var cmd_src)\' == \'circle\'')" />
    <node pkg="teleop_twist_keyboard" exec="teleop_twist_keyboard" name="teleop"
        output="screen" launch-prefix="xterm -e"
        if="$(eval '\'$(var cmd_src)\' == \'teleop\'')" />

    <group if="$(eval '\'$(var robot)\' == \'nusim\'')" >
        <include file="$(find-pkg-share nuturtle_description)/launch/load_one.launch.py">
            <arg name="use_rviz" value="false"/>
            <arg name="color" value="red"/>
        </include>
        <node pkg="nusim" exec="nusim"
            args="--ros-args --params-file $(find-pkg-share nusim)/config/basic_world.yaml" >
            <!-- <remap from="/wheel_cmd" to="red/wheel_cmd"/> -->
            <!-- <remap from="/sensor_data" to="red/sensor_data"/> -->
        </node>
    </group>
    
    <group> <!-- if="$(eval '\'$(var robot)\' != \'localhost\'')" > -->
        <include file="$(find-pkg-share nuturtle_description)/launch/load_one.launch.py" >
            <arg name="use_rviz" value="false"/>
            <arg name="color" value="blue"/>
        </include>
    </group>
    <!-- <group if="$(eval '\'$(var robot)\' == \'localhost\'')" >
        <include file="$(find-pkg-share nuturtle_description)/launch/load_one.launch.py" >
            <arg name="use_rviz" value="false"/>
            <arg name="color" value="blue"/>
        </include>
    </group> -->
    
    <node pkg="tf2_ros" exec="static_transform_publisher"
        args="0 0 0 0 0 0 nusim/world odom"/>
    
    <node pkg="rviz2" exec="rviz2" name="rviz2" 
        args="-d $(find-pkg-share turtle_control)/config/turtle_control.rviz"
        if="$(eval '\'$(var robot)\' != \'localhost\' and \'$(var use_rviz)\' == \'true\'')" />
    
</launch>